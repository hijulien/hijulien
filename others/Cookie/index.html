<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-others docs-doc-id-Cookie/Cookie">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Cookie | note</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://hijulien.github.io/hijulien/others/Cookie/"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-others-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-others-current"><meta data-rh="true" property="og:title" content="Cookie | note"><meta data-rh="true" name="description" content="一、Cookie 是什么？"><meta data-rh="true" property="og:description" content="一、Cookie 是什么？"><link data-rh="true" rel="icon" href="/hijulien/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hijulien.github.io/hijulien/others/Cookie/"><link data-rh="true" rel="alternate" href="https://hijulien.github.io/hijulien/others/Cookie/" hreflang="zh"><link data-rh="true" rel="alternate" href="https://hijulien.github.io/hijulien/others/Cookie/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/hijulien/blog/rss.xml" title="note RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/hijulien/blog/atom.xml" title="note Atom Feed"><link rel="stylesheet" href="/hijulien/assets/css/styles.d03fc8fd.css">
<link rel="preload" href="/hijulien/assets/js/runtime~main.718245ef.js" as="script">
<link rel="preload" href="/hijulien/assets/js/main.0ab3954e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/hijulien/"><div class="navbar__logo"><img src="/hijulien/img/julien.jpg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/hijulien/img/julien.jpg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Hi Julien</b></a><a class="navbar__item navbar__link" href="/hijulien/frontend/JavaScript">frontend</a><a class="navbar__item navbar__link" href="/hijulien/backend/Linux">backend</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/hijulien/others/Git">others</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" path="docs/something" href="/hijulien/docs/第 1 章 内存与数据结构">小专栏</a><a href="https://github.com/hijulien/notes" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/hijulien/others/Git/">Git</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/hijulien/others/Http/">Http</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/hijulien/others/Cookie/">Cookie</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/hijulien/others/Cookie/">Cookie</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/hijulien/others/Regular/">Regular</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/hijulien/others/Nginx/">Nginx</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/hijulien/others/Identification/">Identification</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/hijulien/others/Bash/intro">Bash</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/hijulien/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Cookie</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Cookie</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Cookie</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一cookie-是什么">一、Cookie 是什么？<a href="#一cookie-是什么" class="hash-link" aria-label="一、Cookie 是什么？的直接链接" title="一、Cookie 是什么？的直接链接">​</a></h2><p><img loading="lazy" alt="图片" src="/hijulien/assets/images/1-7ecd6e449512a999bf59704e7719c9fa.bin" width="713" height="485" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二fortune-cookie">二、Fortune cookie<a href="#二fortune-cookie" class="hash-link" aria-label="二、Fortune cookie的直接链接" title="二、Fortune cookie的直接链接">​</a></h2><p>Cookie，它的名字源自一种叫 Fortune cookie 的饼干，这种饼干里面有一张写着精辟句子的小纸条。</p><p>在浏览器中，Cookie 是服务器让浏览器帮忙携带信息的手段，就像饼干里的纸条，<strong>浏览器会储存它，并且在后续的 HTTP 请求中再次发送给服务器</strong>。</p><p><img loading="lazy" alt="图片" src="/hijulien/assets/images/2-49697e47293c4a76e8d62ee8cfec0a9b.bin" width="590" height="340" class="img_ev3q"></p><p><img loading="lazy" alt="图片" src="/hijulien/assets/images/3-fd92b18bad01eb26b6e00f0453793dc3.bin" width="601" height="319" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="三cookie-应用">三、Cookie 应用<a href="#三cookie-应用" class="hash-link" aria-label="三、Cookie 应用的直接链接" title="三、Cookie 应用的直接链接">​</a></h2><p>主要用于以下三个方面：</p><ul><li>会话状态管理（如用户登录状态、购物车、游戏分数或其它需要记录的信息）</li><li>个性化设置（如用户自定义设置、主题等）</li><li>浏览器行为跟踪（如跟踪分析用户行为等）</li></ul><p>因为 HTTP 是无状态的，所以为了协助 Web 保持状态，Cookie 诞生了。在 HTML5 的 localStorage、sessionStorage 出现之前，它作为当时唯一的储存手段也曾一度被用于客户端储存。</p><p>随着浏览器储存机制的完善，为了减小不必要的性能开销（因为每次请求浏览器都会携带 Cookie 数据），一些<strong>客户端需要而服务器不需要的数据的场景渐渐被其他储存方式替代</strong>，例如记住用户的主题信息，Cookie 的应用场景也渐渐回归初心。</p><p>目前 Cookie 主要用于会话状态管理，以用户登录-退出登陆为例，Cookie 的生命周期如下：</p><p>前端通过用户登录 API 向后端传递用户信息，后端核对与数据库信息是否匹配。</p><p>匹配后<strong>在登录 API 返回头部 <code>set-cookie</code> 返回记录用户状态的 cookie 值 userToken：</strong></p><p><img loading="lazy" alt="图片" src="/hijulien/assets/images/4-d3d78781c87d502001ac3c51b7e476f5.bin" width="1080" height="316" class="img_ev3q"></p><p>浏览器按照 <code>set-cookie</code> 的规则解析后存入浏览器</p><p><img loading="lazy" alt="图片" src="/hijulien/assets/images/5-52122de0f87128ae3b6f2446a7d1ad86.bin" width="1080" height="228" class="img_ev3q"></p><p><strong>后续浏览器会自动将 userToken 加到满足条件（域名、路径）的 API 的 请求头部 cookie 中</strong></p><p><img loading="lazy" alt="图片" src="/hijulien/assets/images/6-deaa0d40e74b0ae384dc67fd6d424b41.bin" width="1080" height="231" class="img_ev3q"></p><p>如果退出登陆，返回头部的 <code>set-cookie</code> 会拜托浏览器帮忙删除 userToken，浏览器的 cookie 储存库就会将 userToken 字段删除，后续的 API 请求头部 <code>cookie</code> 也不会发送它</p><p><img loading="lazy" alt="图片" src="/hijulien/assets/images/7-8a721286fcc240cfc0794e5fa7774808.bin" width="1046" height="383" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="四如何设置-cookie">四、如何设置 Cookie<a href="#四如何设置-cookie" class="hash-link" aria-label="四、如何设置 Cookie的直接链接" title="四、如何设置 Cookie的直接链接">​</a></h2><p>服务端和浏览器有不同设置 Cookie 的方式。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="速查表">速查表<a href="#速查表" class="hash-link" aria-label="速查表的直接链接" title="速查表的直接链接">​</a></h3><table><thead><tr><th>平台</th><th>操作示例</th><th>说明</th></tr></thead><tbody><tr><td>服务器</td><td>set-cookie:<!-- -->[cookie-name]<!-- -->=<!-- -->[cookie-value]</td><td>服务端通过设置set-cookie控制Cookie</td></tr><tr><td>浏览器 document.cookie</td><td>document.cookie=&quot;cookie-value&quot;;</td><td>获取并设置当前文档相关联的cookie，操作不灵活</td></tr><tr><td>浏览器 Cookie Store API</td><td>cookieStore.set(&quot;name&quot;,&quot;value&quot;)</td><td>新特性，仅支持在HTTPS中使用，目前还在实验阶段</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="详细说明">详细说明<a href="#详细说明" class="hash-link" aria-label="详细说明的直接链接" title="详细说明的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="服务端set-cookie">服务端：Set-Cookie<a href="#服务端set-cookie" class="hash-link" aria-label="服务端：Set-Cookie的直接链接" title="服务端：Set-Cookie的直接链接">​</a></h4><blockquote><p>服务端以 Node.js 为例，不同语言有不同的用法，但 Cookie 设置逻辑是一样的</p></blockquote><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const http = require(&quot;http&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .createServer((req, res) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (req.url === &quot;/read&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 读取 Cookie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      res.end(`Read Cookie: ${req.headers.cookie || &quot;&quot;}`);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else if (req.url === &quot;/write&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 设置 Cookie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      res.setHeader(&quot;Set-Cookie&quot;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        `name=scar;`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //set-cookie 属性大小写不敏感，你可以写成 path=/ 或者 Path=/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        `language=javascript;Path=/; HttpOnly;Expires=${new Date(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Date.now() + 1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ).toUTCString()};`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      res.end(&quot;Write Success&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else if (req.url === &quot;/delete&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 删除 cookie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      res.setHeader(&quot;Set-Cookie&quot;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 设置过期时间为过去的时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        `name=;expires=${new Date(1).toUTCString()}`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 有效期 max-age 设置成 0 或 -1 这种无效秒，让 cookie 当场去世</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 有些浏览器不支持 max-age 属性，所以用此方法需要考虑兼容性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;language=javascript; max-age=0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      res.end(&quot;Delete Success&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      res.end(&quot;Not Found&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .listen(3000);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="客户端documentcookie">客户端：document.cookie<a href="#客户端documentcookie" class="hash-link" aria-label="客户端：document.cookie的直接链接" title="客户端：document.cookie的直接链接">​</a></h4><p>客户端通过浏览器方法 document.cookie 读写当前界面的 Cookie。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 编辑 ookie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">document.cookie = &quot;name=scar&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">document.cookie = &quot;language=javascript&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 读取 Cookie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(document.cookie);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//name=scar; language=javascript</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 删除 Cookie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">document.cookie = &quot;name=scar;expires=Thu, 01 Jan 1970 00:00:01 GMT&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="客户端cookie-store-api">客户端：Cookie Store API<a href="#客户端cookie-store-api" class="hash-link" aria-label="客户端：Cookie Store API的直接链接" title="客户端：Cookie Store API的直接链接">​</a></h4><p>Cookie Store API 目前正在试验阶段，Firefox、Safari 浏览器 还不支持，所以不建议在生产环境使用，相信在将来我们会用上它更方便地操作 Cookie。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 读取 Cookie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">await cookieStore.get(&quot;enName&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">await cookieStore.getAll();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 设置 Cookie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const day = 24 * 60 * 60 * 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cookieStore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .set({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: &quot;enName&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value: &quot;scar&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    expires: Date.now() + day,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    domain: &quot;scar.siteÏ&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .then(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    function () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      console.log(&quot;It worked!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    function (reason) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      console.error(&quot;It failed: &quot;, reason);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 删除 Cookie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">await cookieStore.delete(&quot;session_id&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 监听 Cookie 变化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cookieStore.addEventListener(&quot;change&quot;, (event) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (const cookie of event.changed) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (cookie.name === &quot;name&quot;) sessionCookieChanged(cookie.value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (const cookie of event.deleted) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (cookie.name === &quot;enName&quot;) sessionCookieChanged(null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>除了更方便的用法，他还有以下特性：</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="异步操作">异步操作<a href="#异步操作" class="hash-link" aria-label="异步操作的直接链接" title="异步操作的直接链接">​</a></h5><p>它可以异步访问 Cookie，不阻塞主进程，document.cookie 是同步操作。</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="错误抛出机制">错误抛出机制<a href="#错误抛出机制" class="hash-link" aria-label="错误抛出机制的直接链接" title="错误抛出机制的直接链接">​</a></h5><p>Cookie Store API 有一个明确的机制来报告 Cookie 存储错误，而 document.cookie 如果设置失败也不会提醒，所以需要轮询查 Cookie 的方法来确保设置成功。</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="service-workers-支持">service workers 支持<a href="#service-workers-支持" class="hash-link" aria-label="service workers 支持的直接链接" title="service workers 支持的直接链接">​</a></h5><p>因为 document.cookie 的同步设计，所以 service workers 不支持。Cookie Store API 的异步特性更适合，所以 service workers 支持通过它访问 Cookie。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="五set-cookie-详解">五、Set-Cookie 详解<a href="#五set-cookie-详解" class="hash-link" aria-label="五、Set-Cookie 详解的直接链接" title="五、Set-Cookie 详解的直接链接">​</a></h2><p>从语法可以看出，Set-Cookie 由<strong>前缀、键值对、属性</strong>三部分组成。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; Expires=&lt;date&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 同时指定多个属性 Domain、Secure、HttpOnly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; Domain=&lt;domain-value&gt;; Secure; HttpOnly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// cookie 前缀，值可能性为 __Secure-、__Host-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set-Cookie: &lt;cookie-prefix&gt;&lt;cookie-name&gt;=&lt;cookie-value&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>前缀<!-- -->[非必须]</p></li><li><ul><li>示例：<code>Set-cookie: __Secure-lol=foo;Domain=example.xxx</code>， _Sercure- 就是前缀</li><li>Cookie 前缀需配合属性使用，使 Cookie 更安全</li></ul></li><li><p>键值对（名称=值）</p></li><li><ul><li>示例：<code>Set-cookie: __Secure-lol=foo</code>。</li><li>Cookie 携带信息</li></ul></li><li><p>属性<!-- -->[非必须]</p></li><li><ul><li>示例：<code>Domain=somecompany.co.uk; Path=/; Expires=Wed, 30 Aug 2019 00:00:00 GMT</code></li><li>Cookie 的设置，告诉客户端如何使用 Cookie 信息，可以设置 Cookie 生效的时间、域名等等信息。</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cookie-前缀">Cookie 前缀<a href="#cookie-前缀" class="hash-link" aria-label="Cookie 前缀的直接链接" title="Cookie 前缀的直接链接">​</a></h3><p>Cookie 前缀是一种在 Cookie 名称中携带信息的方式，它必须和某些属性同时出现，否则 Cookie 无法设置成功。</p><table><thead><tr><th align="left">名称</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">__Secure-</td><td align="left">必须同时设置 Secure 属性</td></tr><tr><td align="left">__Host-</td><td align="left">必须同时设置 Path=/ 和 Secure 属性，且不能设置 Domain 属性。 限制来自安全域的 Cookie 被作用在不安全的域上</td></tr></tbody></table><p>例子：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 支持 Cookie 前缀的收到下面设置的时候会拒绝，因为没有同时设置 Secure 属性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">document.cookie = &quot;__Secure-invalid-without-secure=1&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 这样设置才能成功！</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">document.cookie = &quot;__Secure-valid-with-secure=1; Secure&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 当响应来自于一个安全域（HTTPS）的时候，二者都可以被客户端接受</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set-Cookie: __Secure-ID=123; Secure; Domain=example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set-Cookie: __Host-ID=123; Secure; Path=/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 缺少 Secure 属性，会被拒绝</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set-Cookie: __Secure-id=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 缺少 Path=/ ，会被拒绝</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set-Cookie: __Host-id=1; Secure</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>说实话这个前缀我之前从没见过，孤陋寡闻了。</p><p>除了 IE 不支持，其他各大浏览器基本支持。不同浏览器限制可能不同，例如：<code>Set-Cookie: __Host-id=1; Secure</code>设置 <code>__Host-</code>前缀的时候，即使缺少 <code>Path=/</code>，FireFox 可以设置成功，而 Chrome 会拒绝。</p><blockquote><p><strong>但为什么有 <code>Secure</code> 属性还要加个 <code>__Secure-</code> 前缀呢？</strong></p><p>因为 <code>Secure</code> 属性设置后是可以被人恶意移除的，而 Cookie 名称被人移除前缀，服务器不会认它，所以更加安全。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cookie-键值对">Cookie 键值对<a href="#cookie-键值对" class="hash-link" aria-label="Cookie 键值对的直接链接" title="Cookie 键值对的直接链接">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;cookie-name&gt;=&lt;cookie-value&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>真正携带信息的部分，例如：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">id=38afes7a8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>&lt;cookie-name&gt;</code> 可以是除了控制字符 (CTLs)、空格 (spaces) 或制表符 (tab)之外的任何 US-ASCII 字符。同时不能包含以下分隔字符：( ) &lt; &gt; @ , ; : \ &quot; / <!-- -->[ ]<!-- --> ? = { }。</p><p><code>&lt;cookie-value&gt;</code> 非必填，如果有值，那么需要包含在双引号里面。支持除了控制字符（CTLs）、空格（whitespace）、双引号（double quotes）、逗号（comma）、分号（semicolon）以及反斜线（backslash）之外的任意 US-ASCII 字符。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cookie-属性">Cookie 属性<a href="#cookie-属性" class="hash-link" aria-label="Cookie 属性的直接链接" title="Cookie 属性的直接链接">​</a></h3><p>Cookie 属性可以理解为 Cookie 的配置项，告诉浏览器 Cookie 的一些额外信息，例如什么时候失效</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="速查表-1">速查表<a href="#速查表-1" class="hash-link" aria-label="速查表的直接链接" title="速查表的直接链接">​</a></h4><table><thead><tr><th align="left">Cookie 属性</th><th align="left">说明</th><th align="left">类型</th><th align="left">默认值</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left">Domain</td><td align="left">生效域名</td><td align="left">String</td><td align="left">当前访问地址中的 host 部分</td><td align="left">scar.site</td></tr><tr><td align="left">Path</td><td align="left">生效路径</td><td align="left">String</td><td align="left">/</td><td align="left">/docs</td></tr><tr><td align="left">Expires</td><td align="left">过期时间</td><td align="left">Date</td><td align="left">浏览器会话关闭时间</td><td align="left">Thu, 22 Jul 2021 00:53:13 GMT</td></tr><tr><td align="left">Max-Age</td><td align="left">有效期，单位秒</td><td align="left">Number</td><td align="left"></td><td align="left">1000</td></tr><tr><td align="left">Secure</td><td align="left">仅 HTTPS 可用</td><td align="left"></td><td align="left"></td><td align="left"><code>无值</code>，出现即设置</td></tr><tr><td align="left">HttpOnly</td><td align="left">设置了 HttpOnly 属性的 cookie 不能使用 JavaScript 进行访问</td><td align="left"></td><td align="left"></td><td align="left"><code>无值</code>，出现即设置</td></tr><tr><td align="left">SameSite</td><td align="left">允许服务器设定 Cookie 不随着跨站请求一起发送</td><td align="left">string</td><td align="left">Lax</td><td align="left">值可能性为: Lax Strict None</td></tr><tr><td align="left">SameParty</td><td align="left">允许特定条件跨域共享 Cookie</td><td align="left"></td><td align="left"></td><td align="left"><code>无值</code>，出现即设置</td></tr><tr><td align="left">Priority</td><td align="left">优先级，仅 Chrome 支持</td><td align="left"></td><td align="left">Medium</td><td align="left">值可能性为: Low Medium High</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="详细说明-1">详细说明<a href="#详细说明-1" class="hash-link" aria-label="详细说明的直接链接" title="详细说明的直接链接">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="domain">Domain<a href="#domain" class="hash-link" aria-label="Domain的直接链接" title="Domain的直接链接">​</a></h5><p><code>Domain</code> 指定了哪些主机地址可以接收 Cookie。来看看如下设置：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Set-Cookie: __Secure-ID=123; Secure; Domain=example.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>表示只要请求的目标地址匹配 Domain 规则，那 Cookie 就会被发送过去，所即使<code>scar.site</code> 向 <code>example.com</code> 发起的请求，Cookie 会被发送过去。<strong>所以不要再误会 <code>Domain</code>是发起请求的域名啦，其实是接受请求的域名</strong>。</p><p>如果不设置，默认为 origin，<strong>不包含子域名</strong>，如果指定了<code>Domain</code>，则一般包含子域名，例如，如果设置 <code>Domain=mozilla.org</code>，则 Cookie 也包含在子域名中（如<code>developer.mozilla.org</code>）。</p><blockquote><p>当前大多数浏览器遵循 RFC 6265，设置 <code>Domain</code> 时 不需要加前导点。浏览器不遵循该规范，则需要加前导点，例如：<code>Domain=.mozilla.org</code></p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="path">Path<a href="#path" class="hash-link" aria-label="Path的直接链接" title="Path的直接链接">​</a></h5><p><code>Path</code> 标识指定了主机下的哪些路径可以接受 Cookie（该 URL 路径必须存在于请求 URL 中）。以字符 <code>%x2F</code> (&quot;/&quot;) 作为路径分隔符，子路径也会被匹配。</p><p>例如，设置 <code>Path=/docs</code>，则以下地址都会匹配：</p><ul><li><code>/docs</code></li><li><code>/docs/Web/</code></li><li><code>/docs/Web/HTTP</code></li></ul><h5 class="anchor anchorWithStickyNavbar_LWe7" id="expires">Expires<a href="#expires" class="hash-link" aria-label="Expires的直接链接" title="Expires的直接链接">​</a></h5><p>设置过期时间，可以传一个符合 HTTP-Date 格式的值，例如：<code>expires=Mon, 14 Mar 2022 15:39:34 GMT;</code></p><p>如果不设置 <code>Expires</code>，则默认为会话关闭时间;</p><blockquote><p>会话是浏览器的一个概念，一般是一个浏览器 Tab 窗口。</p><p>如果浏览器提供了会话恢复功能，恢复回话之时，Cookie 也会一起恢复，就好像会话从来没有关闭一样。</p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="max-age">Max-Age<a href="#max-age" class="hash-link" aria-label="Max-Age的直接链接" title="Max-Age的直接链接">​</a></h5><p>在 Cookie 失效之前需要经过的秒数。秒数为 0 或 -1 将会使 cookie 直接过期。一些老的浏览器（IE 6、IE 7 和 IE 8）不支持这个属性。</p><p>如果 <code>Expires</code> 和<code>Max-Age</code> 同时存在时，<code>Max-Age</code>优先级更高。</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="httponly">HttpOnly<a href="#httponly" class="hash-link" aria-label="HttpOnly的直接链接" title="HttpOnly的直接链接">​</a></h5><p>设置了 HttpOnly 属性的 cookie 不能使用 JavaScript 经由  <code>Document.cookie</code> 属性、<code>XMLHttpRequest</code> 和  <code>Request</code> APIs、<code>Cookie Store</code> APIs 进行访问。</p><p><img loading="lazy" alt="图片" src="/hijulien/assets/images/8-cb5d6cde22dcb8febccd2264e9273099.bin" width="1080" height="116" class="img_ev3q"></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="secure">Secure<a href="#secure" class="hash-link" aria-label="Secure的直接链接" title="Secure的直接链接">​</a></h5><p>标记为 <code>Secure</code> 的 Cookie 只应通过被 HTTPS 协议加密过的请求发送给服务端，因此可以预防 man-in-the-middle 攻击。</p><p>但即便设置了 <code>Secure</code> 标记，敏感信息也不应该通过 Cookie 传输，因为 Cookie 固有的不安全性，<code>Secure</code> 标记也无法提供确实的安全保障，例如：可以访问客户端硬盘的人可以读取它。</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="samesite">SameSite<a href="#samesite" class="hash-link" aria-label="SameSite的直接链接" title="SameSite的直接链接">​</a></h5><p>服务器要求某个 Cookie 在跨站请求时不会被发送，从而可以阻止跨站请求伪造攻击。</p><p>SameSite 可以有下面三种值：</p><ul><li><p><strong><code>None</code></strong>：浏览器会在同站请求、跨站请求下继续发送 Cookies，不区分大小写。</p></li><li><p><strong><code>Strict</code></strong>：浏览器将只在访问站点与 Cookie 生效的域相同时发送 Cookie。</p></li><li><p><strong><code>Lax</code></strong>：新版本浏览器默认设置为 Lax。与 <code>Strict</code> 类似，但是特定条件也可以发送跨域请求：</p><p>举个例子，用户从 a.com 跳转到 b.com，URL 发生了变化的同时请求方式为 GET，所以 设置了 <code>Lax</code>的 Cookie 会被发送过去 ，除此之外还有图片加载、iframe 调用等等。</p></li><li><ul><li>URL 必须发生变化</li><li>HTTP 请求方式必须是安全的，例如 <code>GET</code>、<code>HEAD</code>、<code>OPTIONS</code>，它们不改变数据。</li></ul></li></ul><h6 class="anchor anchorWithStickyNavbar_LWe7" id="samesite-和-domain-的区别">SameSite 和 Domain 的区别<a href="#samesite-和-domain-的区别" class="hash-link" aria-label="SameSite 和 Domain 的区别的直接链接" title="SameSite 和 Domain 的区别的直接链接">​</a></h6><p>上面提到过，<code>Domain</code> 可以指定 Cookie 生效的域名，那它和 <code>Domain</code>的区别是什么呢？</p><p><strong><code>Domain</code> 属性限制了接收 Cookie 的域名，而 <code>SameSite</code>属性限制了发送 Cookie 的域名</strong></p><p>举个例子：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Set-Cookie: Foo=bar; Path=/; Secure; Domain=scar.site;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>无论是从 <code>scar.site</code> 还是 <code>foo.example.com</code> 发起的请求，只要被发送到了 <code>scar.site</code> 或者它的子域名，那 Cookie 就能发过去。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Set-Cookie: name=scar; Path=/; Secure; Domain=scar.site;SameSite=strict;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果设置了 <code>SameSite=strict</code>,那么这个请求只能从 <code>scar.site</code> 发起 Cookie 才能带过去。</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="sameparty">SameParty<a href="#sameparty" class="hash-link" aria-label="SameParty的直接链接" title="SameParty的直接链接">​</a></h5><blockquote><p>目前还在实验阶段</p></blockquote><p>配合  <code>First-Party Sets</code> 实现跨域共享属性，详细可以访问：详解 Cookie 新增的 SameParty 属性。</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="priority">Priority<a href="#priority" class="hash-link" aria-label="Priority的直接链接" title="Priority的直接链接">​</a></h5><blockquote><p>目前只有 Chrome 实现了这个提案</p></blockquote><p>因为 Cookie 有数量限制，所以在 Cookie 超过一定数量时，浏览器会清除最早过期的 Cookie。</p><p>如果设置了 Priority，Chrome 会先将优先级低的清除，并且每种优先级 Cookie 至少保留一个。可以有下面三种值：</p><ul><li>Low：低优先级</li><li>Medium：默认值，中优先级</li><li>High：高优先级</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="六qa">六、Q&amp;A<a href="#六qa" class="hash-link" aria-label="六、Q&amp;A的直接链接" title="六、Q&amp;A的直接链接">​</a></h2><p>一些关于 Cookie 的疑问和新特性，以 Q&amp;A 形式记录。比较杂、比较散，可以说没什么知识点全是感情，属于那种你知道了可能没什么用但是就是想把它弄懂。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-cookie-的限制">1. Cookie 的限制<a href="#1-cookie-的限制" class="hash-link" aria-label="1. Cookie 的限制的直接链接" title="1. Cookie 的限制的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="大小限制">大小限制<a href="#大小限制" class="hash-link" aria-label="大小限制的直接链接" title="大小限制的直接链接">​</a></h4><p>大多数浏览器支持最大为 4KB 的 Cookie，4KB 是针对 Cookie 单条记录的 Value 值。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="数量限制">数量限制<a href="#数量限制" class="hash-link" aria-label="数量限制的直接链接" title="数量限制的直接链接">​</a></h4><p>Cookie 有数量限制，而且只允许每个站点存储一定数量的 Cookie，当超过时，最早过期的 Cookie 便被删除。</p><p>不同浏览器支持的数量可能不同, 基于 Webkit 内核的是 180 个，基于 gecko 内核的是 150 个，感兴趣可以访问江涛学编程-编写的 Cookie 实验 试试自己的浏览器 Cookie 数量限制</p><blockquote><p>实际上影响 Cookie 被删除的要素不止是 <code>Expires</code> 和 <code>Max-Age</code>，还有 <code>Priority</code>、<code>Secure</code>，对移除策略感兴趣的可以看：Cookie 知识二则</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-和-cookie-相关的不安全事件有哪些">2. 和 Cookie 相关的不安全事件有哪些？<a href="#2-和-cookie-相关的不安全事件有哪些" class="hash-link" aria-label="2. 和 Cookie 相关的不安全事件有哪些？的直接链接" title="2. 和 Cookie 相关的不安全事件有哪些？的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="csrf-攻击">CSRF 攻击<a href="#csrf-攻击" class="hash-link" aria-label="CSRF 攻击的直接链接" title="CSRF 攻击的直接链接">​</a></h4><blockquote><p>CSRF：跨站请求攻击，简单地说，是攻击者通过一些技术手段欺骗用户的浏览器去访问一个自己曾经认证过的网站并运行一些操作（如发邮件，发消息，甚至财产操作如转账和购买商品）。</p></blockquote><p>举个例子，一家银行用以运行转账操作的 URL 如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http://www.examplebank.com/withdraw?account=AccoutName&amp;amount=1000&amp;for=PayeeName</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>那么，一个恶意攻击者可以在另一个网站上放置如下代码：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;img src=&quot;&lt;http://www.examplebank.com/withdraw?account=scar&amp;amount=1000&amp;for=Badman&gt;&quot;&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果有账户名为 Alice 的用户访问了恶意站点，而她之前刚访问过银行不久，登录信息尚未过期，导致发起请求后后端以为是用户正常操作，于是进行扣款操作，那么她就会损失 1000 资金。通过设置 <code>sameSite</code> 可以防止跨域发送 Cookie，抵御 CSRF。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="xss-攻击">XSS 攻击<a href="#xss-攻击" class="hash-link" aria-label="XSS 攻击的直接链接" title="XSS 攻击的直接链接">​</a></h4><blockquote><p>跨站脚本（Cross-site scripting）是一种网站应用程序的安全漏洞攻击，简称为 CSS, 但这会与层叠样式表（Cascading Style Sheets）CSS的缩写混淆。因此，跨站脚本攻击缩写为 XSS。</p></blockquote><p>XSS 攻击通常指的是通过利用网页开发时留下的漏洞，通过巧妙的方法注入恶意指令代码到网页，使用户加载并执行攻击者恶意制造的网页程序。攻击成功后，攻击者可能得到 Cookie 从而实现攻击。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-floc-替代第三方-cookie">3. Floc 替代第三方 Cookie？<a href="#3-floc-替代第三方-cookie" class="hash-link" aria-label="3. Floc 替代第三方 Cookie？的直接链接" title="3. Floc 替代第三方 Cookie？的直接链接">​</a></h3><blockquote><p>引用自：如果不用第三方 Cookie，Google FLoC 会是更好的替代者吗？- 少数派</p></blockquote><p>FLoC 是一种新的广告追踪技术，全称为 Federated Learning of Cohorts，即「同类群组联合学习」。FLoC 的工作原理是监视你的浏览记录，为访客的汇总行为分配一个 ID，然后将具有类似浏览行为的浏览器分组在一起。这些群组的数据称为同类群组，然后用于向人们展示针对性更强的广告。</p><p><img loading="lazy" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片" class="img_ev3q"></p><p><strong>FLoC 在自身设计层面，是比 Cookie 隐私性更好的</strong>，但是首先它依然是一个广告追踪技术，其次才是一个相对保护隐私的广告追踪技术。</p><p>FLoC 由 Google 主导，所以三方团体担忧：当所有的浏览器开始默认屏蔽第三方 Cookie，广告商转向使用 FLoC 以后，Google 将在广告追踪市场一家独大。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-同名-cookie-发送时优先级如何判断">4. 同名 Cookie 发送时，优先级如何判断？<a href="#4-同名-cookie-发送时优先级如何判断" class="hash-link" aria-label="4. 同名 Cookie 发送时，优先级如何判断？的直接链接" title="4. 同名 Cookie 发送时，优先级如何判断？的直接链接">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Cookie: a=2; a=1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>首先来看看 <code>Cookie</code> 发送顺序，RFC 6265提案提到：</p><ul><li><code>Path</code> 属性较长的应该在前面</li><li>如果 <code>Path</code> 路径一样，创建时间早的在前面</li></ul><p>具体的浏览器表现我没有去探究，但提案只是倡导，所以每个客户端不一定会按照它实现 Cookie 的发送顺序。</p><p>除了考虑发送顺序，还要考虑不同的服务器框架可能有不同的接收逻辑，所以笔者推荐尽量避免出现同名 Cookie，减少端表现不统一带来的不确定性。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-如何快速调试-cookie">5. 如何快速调试 Cookie<a href="#5-如何快速调试-cookie" class="hash-link" aria-label="5. 如何快速调试 Cookie的直接链接" title="5. 如何快速调试 Cookie的直接链接">​</a></h3><p>F12 打开控制台可以快速看到本域下的所有 Cookie</p><p><img loading="lazy" alt="图片" src="/hijulien/assets/images/9-56f4dc12a4361c34dc97cdbb379f00d3.bin" width="1080" height="194" class="img_ev3q"></p><p>通过分析 Cookie 属性来定位问题。</p><p>例如某个 Cookie 导致了业务问题，如果它设置了 HttpOnly，那么代表客户端无法操作 Cookie，可以快速的把问题定位到 API 层面。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/hijulien/others/Http/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Http</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/hijulien/others/Regular/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Regular</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一cookie-是什么" class="table-of-contents__link toc-highlight">一、Cookie 是什么？</a></li><li><a href="#二fortune-cookie" class="table-of-contents__link toc-highlight">二、Fortune cookie</a></li><li><a href="#三cookie-应用" class="table-of-contents__link toc-highlight">三、Cookie 应用</a></li><li><a href="#四如何设置-cookie" class="table-of-contents__link toc-highlight">四、如何设置 Cookie</a><ul><li><a href="#速查表" class="table-of-contents__link toc-highlight">速查表</a></li><li><a href="#详细说明" class="table-of-contents__link toc-highlight">详细说明</a></li></ul></li><li><a href="#五set-cookie-详解" class="table-of-contents__link toc-highlight">五、Set-Cookie 详解</a><ul><li><a href="#cookie-前缀" class="table-of-contents__link toc-highlight">Cookie 前缀</a></li><li><a href="#cookie-键值对" class="table-of-contents__link toc-highlight">Cookie 键值对</a></li><li><a href="#cookie-属性" class="table-of-contents__link toc-highlight">Cookie 属性</a></li></ul></li><li><a href="#六qa" class="table-of-contents__link toc-highlight">六、Q&amp;A</a><ul><li><a href="#1-cookie-的限制" class="table-of-contents__link toc-highlight">1. Cookie 的限制</a></li><li><a href="#2-和-cookie-相关的不安全事件有哪些" class="table-of-contents__link toc-highlight">2. 和 Cookie 相关的不安全事件有哪些？</a></li><li><a href="#3-floc-替代第三方-cookie" class="table-of-contents__link toc-highlight">3. Floc 替代第三方 Cookie？</a></li><li><a href="#4-同名-cookie-发送时优先级如何判断" class="table-of-contents__link toc-highlight">4. 同名 Cookie 发送时，优先级如何判断？</a></li><li><a href="#5-如何快速调试-cookie" class="table-of-contents__link toc-highlight">5. 如何快速调试 Cookie</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright @ 2023 The way to becoming a god.</div></div></div></footer></div>
<script src="/hijulien/assets/js/runtime~main.718245ef.js"></script>
<script src="/hijulien/assets/js/main.0ab3954e.js"></script>
</body>
</html>